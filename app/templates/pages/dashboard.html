{% extends "base.html" %}
{% from "components/ui_components.html" import page_header, empty_state %}

{% block title %}Minhas Solicitações - SS-54{% endblock %}

{% block content %}
<section class="min-h-[calc(100vh-200px)] bg-gradient-to-br from-slate-50 via-blue-50/30 to-slate-50 py-6 sm:py-12">
    <div class="max-w-5xl mx-auto px-4 sm:px-6">

        {{ page_header(
            title="Solicitações",
            subtitle="Acompanhe o andamento dos seus processos",
            back_url="/",
            back_text="Início",
            action_url="/novo",
            action_text="Nova Solicitação",
            action_icon="plus"
        ) }}

        {% if processes %}
        <div class="space-y-3 sm:space-y-4">
            {% for process in processes %}
            <a href="/processo/{{ process.id }}"
                class="block bg-white rounded-xl shadow-sm hover:shadow-md border border-slate-100 hover:border-accent/30 p-4 sm:p-5 transition-all">

                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3 sm:gap-4">
                    <div class="flex-1">
                        <div class="flex items-center gap-2 sm:gap-3 mb-1.5 sm:mb-2">
                            <span class="font-mono text-xs sm:text-sm text-slate-500">
                                {{ process.protocol_number }}
                            </span>
                            {% with status=process.status, status_labels=status_labels %}
                            {% include "components/status_badge.html" %}
                            {% endwith %}
                        </div>

                        <h3 class="font-medium text-primary text-sm sm:text-base">
                            {{ process_type_titles[process.type] }}
                        </h3>

                        <p class="text-xs sm:text-sm text-slate-500 mt-1">
                            Criado em {{ process.created_at | date("%d/%m/%Y às %H:%M") }}
                        </p>
                    </div>

                    <div class="flex items-center gap-3 sm:gap-4">
                        <!-- Document previews -->
                        {% if process.document_previews %}
                        <div class="flex -space-x-2">
                            {% for doc in process.document_previews %}
                            {% if doc.mime_type and doc.mime_type.startswith('image/') %}
                            <div
                                class="w-10 h-10 rounded border-2 border-white overflow-hidden bg-slate-100 flex-shrink-0">
                                <img src="/documentos/{{ doc.id }}/download" alt="{{ doc.original_filename }}"
                                    class="w-full h-full object-cover">
                            </div>
                            {% else %}
                            <div class="w-10 h-10 rounded border-2 border-white bg-red-50 flex items-center justify-center flex-shrink-0"
                                title="{{ doc.original_filename }}">
                                <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" />
                                </svg>
                            </div>
                            {% endif %}
                            {% endfor %}
                            {% if process.document_count > 5 %}
                            <div
                                class="w-10 h-10 rounded border-2 border-white bg-slate-200 flex items-center justify-center flex-shrink-0">
                                <span class="text-xs font-medium text-slate-600">+{{ process.document_count - 5
                                    }}</span>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}

                        <!-- Document count -->
                        <div class="text-center">
                            <p class="text-2xl font-bold text-primary">{{ process.document_count }}</p>
                            <p class="text-xs text-slate-500">Documentos</p>
                        </div>

                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7">
                            </path>
                        </svg>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>

        {% else %}
        {{ empty_state(
            message="Você ainda não enviou nenhuma solicitação. Suas solicitações aparecerão aqui.",
            card=True,
            icon="document",
            title="Nenhuma solicitação ainda"
        ) }}
        {% endif %}
    </div>
</section>
{% endblock %}